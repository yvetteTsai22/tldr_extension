(()=>{let e="";chrome.runtime.onInstalled.addListener(()=>{chrome.storage.local.get(["openaiApiKey"],n=>{n.openaiApiKey?e=n.openaiApiKey:chrome.runtime.openOptionsPage()})}),chrome.runtime.onMessage.addListener((n,t,o)=>{"ANALYZE_CONTENT"===n.type&&async function(n){if(!e)throw new Error("OpenAI API key not set");const t=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a helpful assistant that summarizes articles and answers questions about them."},{role:"user",content:`Please summarize this article in bullet points:\n\n${n}`}],max_tokens:500})});if(!t.ok)throw new Error("Failed to analyze content");return(await t.json()).choices[0].message.content}(n.content).then(e=>{chrome.runtime.sendMessage({type:"CONTENT_ANALYZED",summary:e})}).catch(e=>{console.error("Error analyzing content:",e)})}),chrome.storage.onChanged.addListener((n,t)=>{"local"===t&&n.openaiApiKey&&(e=n.openaiApiKey.newValue)}),chrome.action.onClicked.addListener(e=>{chrome.sidePanel.open({tabId:e.id})})})();